# 搜索 baidu，会用到计算机网络中的什么层
1. 浏览器中输入 URL。浏览器要将 URL 解析为 IP 地址，解析域名就要用到 DNS 协议，首先主机会查询 DNS 的缓存，如果没有就给本地 DNS 发送查询请求。DNS 查询分为两种方式，一种是递归查询，一种是迭代查询。如果是迭代查询，本地的 DNS 服务器，向根域名服务器发送查询请求，根域名服务器告知该域名的一级域名服务器，然后本地服务器给该一级域名服务器发送查询请求，然后依次类推直到查询到该域名的 IP 地址。DNS 服务器是基于 UDP 的，因此会用到 UDP 协议。

> 域名系统(Domain Name System, DNS) 是因特网使用的命名系统，用来把便于人们记忆的具有特定含义的主机名（如www.cskaoyan.com) 转换为便于机器处理的IP 地址。
> **层次域名空间**
![[Pasted image 20201124142917.png]]
**域名服务器**
![[Pasted image 20201124143039.png]]
**域名解析过程**
域名解析是指把域名映射成为IP地址或把IP地址映射成域名的过程。前者称为正向解析，后者称为反向解析。当客户端需要域名解析时，通过本机的DNS 客户端构造一个DNS 请求报文，以UDP 数据报方式发往本地域名服务器。域名解析有两种方式：递归查询和递归与迭代相结合的查询。
![[Pasted image 20201124143245.png]]
下面举例说明域名解析的过程。假定某客户机想获知域名为y.abc.com 主机的IP 地址，域名解析的过程（共使用8 个UDP 报文）如下：
1)客户机向其本地域名服务器发出DNS 请求报文。
2)本地域名服务器收到请求后，查询本地缓存，若没有该记录，则以DNS 客户的身份向根域名服务器发出解析请求。
3)根域名服务器收到请求后，判断该域名属于com 域，将对应的顶级域名服务器dns.com的IP 地址返回给本地域名服务器。
4)本地域名服务器向顶级域名服务器dns.com 发出解析请求报文。
5)顶级域名服务器dns.com 收到请求后，判断该域名属于abc.com 域，因此将对应的授权域名服务器dns.abc.com 的IP 地址返回给本地域名服务器。
6)本地域名服务器向授权域名服务器dns.abc.com 发起解析请求报文。
7)授权域名服务器dns.abc.com 收到请求后，将查询结果返回给本地域名服务器。
8)本地域名服务器将查询结果保存到本地缓存，同时返回给客户机。

2. 得到 IP 地址后，浏览器就要与服务器建立一个 http 连接。因此要用到 http 协议，http 协议报文格式上面已经提到。http 生成一个 get 请求报文，将该报文传给 TCP 层处理，所以还会用到 TCP 协议。如果采用 https 还会使用 https 协议先对 http 数据进行加密。TCP 层如果有需要先将 HTTP 数据包分片，分片依据路径 MTU 和 MSS。TCP 的数据包然后会发送给 IP 层，用到 IP协议。IP 层通过路由选路，一跳一跳发送到目的地址。当然在一个网段内的寻址是通过以太网协议实现(也可以是其他物理层协议，比如 PPP、SLIP)，以太网协议需要直到目的 IP 地址的物理地址，有需要 ARP 协议。

其中：
1. DNS 协议，http 协议，https 协议属于应用层
应用层是体系结构中的最高层。应用层确定进程之间通信的性质以满足用户的需要。这里的进程就是指正在运行的程序。应用层不仅要提供应用进程所需要的信息交换和远地操作，而且还要作为互相作用的应用进程的用户代理，来完成一些为进行语义上有意义的信息交换所必须的功能。应用层直接为用户的应用进程提供服务。
2. TCP/UDP 属于传输层
传输层的任务就是负责主机中两个进程之间的通信。因特网的传输层可使用两种不同协议：即面向连接的传输控制协议 TCP，和无连接的用户数据报协议 UDP。面向连接的服务能够提供可靠的交付，但无连接服务则不保证提供可靠的交付，它只是“尽最大努力交付”。这两种服务方式都很有用，各有其优缺点。在分组交换网内的各个交换结点机都没有传输层。
3. IP 协议，ARP 协议属于网络层
网络层负责为分组交换网上的不同主机提供通信。在发送数据时，网络层将运输层产生的报文段或用户数据报封装成分组或包进行传送。在 TCP/IP 体系中，分组也叫作 IP 数据报，或简称为数据报。网络层的另一个任务就是要选择合适的路由，使源主机运输层所传下来的分组能够交付到目的主机。
4. 数据链路层
当发送数据时，数据链路层的任务是将在网络层交下来的 IP 数据报组装成帧，在两个相邻结点间的链路上传送以帧为单位的数据。每一帧包括数据和必要的控制信息（如同步信息、地址信息、差错控制、以及流量控制信息等）。控制信息使接收端能够知道—个帧从哪个比特开始和到哪个比特结束。控制信息还使接收端能够检测到所收到的帧中有无差错。
5. 物理层
物理层的任务就是透明地传送比特流。在物理层上所传数据的单位是比特。传递信息所利用的一些物理媒体，如双绞线、同轴电缆、光缆等，并不在物理层之内而是在物理层的下面。因此也有人把物理媒体当做第 0 层。
# 阻塞和非阻塞
调用者在事件没有发生的时候，一直在等待事件发生，不能去处理别的任务这是阻塞。调用者在事件没有发生的时候，可以去处理别的任务这是非阻塞。
# 同步和异步
调用者必须循环自去查看事件有没有发生，这种情况是同步。调用者不用自己去查看事件有没有发生，而是等待着注册在事件上的回调函数通知自己，这种情况是异步。

# ==从输入URL到浏览器接收的过程中发生了什么事情？==

> 参考资料（要看！）：
>
> [探究！一个数据包在网络中的心路历程](https://mp.weixin.qq.com/s?__biz=MzUxODAzNDg4NQ==&mid=2247483989&idx=1&sn=7e2ed852770743d3955ef9d5561fcef3&scene=21#wechat_redirect)

1. 在浏览器中输入URL

   用户输入url，例如http://[www.baidu.com](http://www.baidu.com/)。其中http为协议，[www.baidu.com](http://www.baidu.com/)为网络地址，及指出需要的资源在那台计算机上。一般网络地址可以为域名或IP地址，此处为域名。使用域名是为了方便记忆，但是为了让计算机理解这个地址还需要把它解析为IP地址。

2. 应用层DNS解析域名

   客户端先检查本地是否有对应的IP地址，若找到则返回响应的IP地址。若没找到则请求上级DNS服务器，直至找到或到根节点。

   > 1）客户端首先会发出一个 DNS 请求，问 www.server.com 的 IP 是啥，并发给本地 DNS 服务器（也就是客户端的 TCP/IP 设置中填写的 DNS 服务器地址）。
   >
   > 2）本地域名服务器收到客户端的请求后，如果缓存里的表格能找到 www.server.com，则它直接返回 IP 地址。如果没有，本地 DNS 会去问它的根域名服务器：“老大， 能告诉我 www.server.com 的 IP 地址吗？” 根域名服务器是最高层次的，它不直接用于域名解析，但能指明一条道路。
   >
   > 3）根 DNS 收到来自本地 DNS 的请求后，发现后置是 .com，说：“www.server.com 这个域名归 .com 区域管理”，我给你 .com 顶级域名服务器地址给你，你去问问它吧。”
   >
   > 4）本地 DNS 收到顶级域名服务器的地址后，发起请求问“老二， 你能告诉我 www.server.com  的 IP 地址吗？”
   >
   > 5）顶级域名服务器说：“我给你负责 www.server.com 区域的权威 DNS 服务器的地址，你去问它应该能问到”。
   >
   > 6）本地 DNS 于是转向问权威 DNS 服务器：“老三，www.server.com对应的IP是啥呀？” server.com 的权威 DNS 服务器，它是域名解析结果的原出处。为啥叫权威呢？就是我的域名我做主。
   >
   > 7）权威 DNS 服务器查询后将对应的 IP 地址 X.X.X.X 告诉本地 DNS。
   >
   > 8）本地 DNS 再将 IP 地址返回客户端，客户端和目标建立连接。

3. 建立TCP连接

   位于传输层的TCP协议为传输报文提供可靠的字节流服务。它为了方便传输，将大块的数据分割成以报文段为单位的数据包进行管理，并为它们编号，方便服务器接收时能准确地还原报文信息。TCP协议通过“三次握手”等方法保证传输的安全可靠。

4. 应用层发送HTTP请求

   建立TCP连接后，用户电脑开始向Web服务器发送HTTP请求报文。一个典型的http request header一般需要包括请求的方法，例如GET或者POST等，不常用的还有PUT和DELETE、HEAD、OPTION以及TRACE方法，一般的浏览器只能发起GET或者POST请求。

5. 服务器的永久重定向请求

   这里可能会发生用户输入的为“http://baidu.com/”而非“https://www.baidu.com/”的情况，或者“mukewang.com”而不是“https://www.imooc.com/”，这时服务器会给浏览器返回301永久重定向响应，具体301和302状态码的区别、为什么会有重定向响应等问题可以[参见文章](https://www.cnblogs.com/workest/p/3891321.html)。

6. 浏览器跟踪重定向地址

   浏览器收到服务器发来的重定向响应，知道自己应该找李逵，而不是李鬼，改了改了，马上给正确域名地址重新发送HTTP请求，过程如上。

7. 服务器处理请求

8. 服务器返回HTTP响应

   服务器处理完用户请求，会把处理结果返回，即返回一个HTTP相应。

9. 关闭TCP连接

   为了避免服务器与客户端双方的资源占用和损耗，当双方没有请求或响应传递时，任意一方都可以发起关闭请求。与创建TCP连接的3次握手类似，关闭TCP连接，需要4次握手。

10. 浏览器解析HTML、布局渲染

