# redo log

rodo log 是重做日志，通常是物理日志，记录的是数据页的物理修改。redo log包括两部分：一是内存中的日志缓冲(redo log buffer)，该部分日志是易失性的；二是磁盘上的重做日志文件(redo log file)，该部分日志是持久的。

redo log就是保存执行的SQL语句到一个指定的Log文件，当mysql执行数据恢复时，重新执行redo log记录的SQL操作即可。在一个sql语句执行过程中，首先写入redo log buffer中，之后buffer中的数据达到一定量之后写入重做日志，最后写入磁盘，或者每秒向重做日志写入。



# undo log

Undo log 是为了实现事务的原子性。事务的所有操作，要么全部完成，要不都不做，不能只做一半。如果在执行的过程中发生了错误，要回到事务开始时的状态，所有的操作都要回滚。

Undo Log的原理很简单，为了满足事务的原子性，在操作任何数据之前，首先将数据备份到一个地方（这个存储数据备份的地方称为Undo Log）。然后进行数据的修改。如果出现了错误或者用户执行了ROLLBACK语句，系统可以利用Undo Log中的备份将数据恢复到事务开始之前的状态。



# Undo + Redo事务的简化过程 

A.事务开始. 
B.记录A=1到undo log. 
C.修改A=3. 
D.记录A=3到redo log. 
E.记录B=2到undo log. 
F.修改B=4. 
G.记录B=4到redo log. 
H.将redo log写入磁盘。 
I.事务提交



# 缓冲池

InnoDB存储引擎是基于磁盘存储的，并将**其中的记录按照页的方式进行管理**。

**由于CPU速度和磁盘之间的鸿沟**，基于磁盘的数据库系统通常**使用缓冲池技术来提高数据库的整体性能**

**缓冲池的工作原理**：
**①读取操作：**在数据库中进行**读取页**的操作，**首先将从磁盘读到的页存放在缓冲池中**，下一次再读相同的页时，**首先判断该页是否在缓冲池中**。若在缓冲池中，称该页在缓冲池中被命中，直接读取该页；否则，读取磁盘上的页

**②写入/修改操作**：**对于数据库中页的修改操作，则**首先修改在缓冲池中的，然后用再以一定的频率刷新到磁盘上。

**③重做日志缓冲**：InnoDB存储引擎首**先将重做日志信息放入到这个缓冲区，然后按一定频率将其刷新到重做日志文件**。

三种重做日志自动刷新的情景：
1.Master Thread每一秒将重做日志缓冲刷新到重做日志文件
2.每个事务提交后会将重做日志缓冲刷新到重做日志文件
3.当重做日志缓冲池剩余空间小于1/2时，重做日志缓冲刷新到重做日志文件

### mysql innodb_flush_log_at_trx_commit重点看一下这个参数的含义

# 检查点CheckPoint

**Checkpoint（检查点）技术的目的是解决以下几个问题：**

- **①缩短数据库的恢复时间**
  **当数据库发生宕机时，数据库不需要重做所有日志，因为Checkpoint之前的页都已经刷新回磁盘**，故数据库只需要对Checkpoint后的重做日志进行恢复。这样就**大大缩短了恢复时间**
- **②缓冲池不够用时，将脏页刷新到磁盘**
  此外，当缓冲池不可用时，根据LRU算法***\*会溢出最近最少使用的页\****，若此页为脏页，那么***\*需要强制执行Checkpoint\****，将脏页也就是页的新版本刷回磁盘
- **③重做日志不可用时，刷新脏页**